(window.webpackJsonp=window.webpackJsonp||[]).push([["trading-custom-sources"],{"//HS":function(t,e,o){"use strict";o.d(e,"a",(function(){return i})),o.d(e,"b",(function(){return s}));var r=o("jFln");function i(t,e,o,i,s,l,a){t.save(),t.strokeStyle=i;const n=t.lineWidth%2?.5:0;t.translate(e+n,o+n),s&&t.scale(1,-1),Object(r.drawArrow)(t,0,0,0,l,a),t.restore()}function s(t,e,o,r,i,s,l){t.save(),t.strokeStyle=r,t.lineJoin="miter";const a=t.lineWidth%2?.5:0,n=Math.round(s/3);t.translate(e+a,o+a),i&&t.scale(-1,-1),t.beginPath(),t.moveTo(0,s),t.lineTo(0,0),t.lineTo(-l,n),t.stroke(),t.restore()}},EgV8:function(t,e,o){"use strict";o.r(e);var r=o("oV8k"),i=o("Kxc7"),s=o("Eyy1"),l=o("HGP3"),a=o("Y7w9"),n=o("XPit"),c=o("k9/m"),d=o("VdBB"),h=o("//HS");class u{constructor(){this._data={points:[],arrowHeight:0}}setData(t){this._data=t}hitTest(t){for(const e of this._data.points){const o=Math.round(e.x),r=Math.round(e.y),i=4;let s,l;if(e.arrowUp?(s=r,l=r+this._data.arrowHeight):(s=r-this._data.arrowHeight,l=r),t.x>=o-2&&t.x<=o+2&&t.y>=s&&t.y<=l&&""!==e.tooltip)return new d.HitTestResult(d.HitTestResult.CUSTOM,{tooltip:{text:e.tooltip,rect:{x:o-2,y:s,w:i,h:l-s}}})}return null}draw(t,e){const o=e.pixelRatio;t.save(),t.lineWidth=Math.max(1,Math.floor(t.lineWidth*o));const r=Math.max(1,Math.round(4*o)),i=Math.max(1,Math.round(this._data.arrowHeight*o));for(const e of this._data.points){const s=Math.round((e.x-2)*o),l=Math.round(e.y*o);Object(h.a)(t,s,l,e.arrowColor,!e.arrowUp,i,r)}t.restore()}}const _=l.colorsPalette["color-tv-blue-500"],b=l.colorsPalette["color-ripe-red-500"];class p{constructor(t,e){this._invalidated=!0,this._points=[],this._renderer=new u,this._chartModel=t,this._source=e}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}_updateImpl(){this._points=[],this._renderer.setData({points:[],arrowHeight:0});const t=this._chartModel.timeScale().visibleBarsStrictRange();if(null===t)return;const e=this._source.points();if(0===e.length)return;const o=Object(a.lowerbound)(e,t.firstBar(),(t,e)=>t.index<e,0),r=Object(a.upperbound)(e,t.lastBar(),(t,e)=>e.index>t,o);if(o>=r)return;const i=this._chartModel.mainSeries().priceScale().isInverted(),l=new Map;for(let t=o;t<r;t++){const o=e[t],r=l.get(o.index)||v(i);if(void 0===r.x){const t=this._getXCoordinate(o.index);if(null===t)continue;r.x=t}const a=o.isBuyDirection!==i,n=a?"arrowUp":"arrowDown",c=a?1:-1,d=r[n].y;if(void 0===d){const t=this._getYCoordinate(o.index,o.isBuyDirection);if(null===t)continue;r[n].y=t+11*c}else r[n].y=d+19*c;l.set(o.index,r),this._points.push({x:Object(s.ensureDefined)(r.x),y:Object(s.ensureDefined)(r[n].y),arrowUp:a,arrowColor:r[n].color,tooltip:o.tooltip})}this._renderer.setData({points:this._points,arrowHeight:8})}_getXCoordinate(t){const e=this._chartModel.mainSeries().bars().lastIndex();return null===e||t>e?null:this._chartModel.timeScale().indexToCoordinate(t)}_getYCoordinate(t,e){let o=null
;const r=this._chartModel.mainSeries(),i=r.priceSource(),s=null!==i?i:e?"low":"high",l=Object(n.barFunction)(s),a=r.nearestData(t,c.PlotRowSearchMode.NearestLeft);if(void 0!==a){const t=l(a.value);if(!Number.isNaN(t)){const e=r.firstValue();null!==e&&(o=this._chartModel.mainSeries().priceScale().priceToCoordinate(t,e))}}return o}}function v(t){let e,o;return t?(e=b,o=_):(e=_,o=b),{x:void 0,arrowUp:{y:void 0,color:e},arrowDown:{y:void 0,color:o}}}o.d(e,"ExecutionsSource",(function(){return m}));class m extends r.a{constructor(t,e,o,r,i){super(t,e),this._paneViews=[],this._executionsPointsManager=i,this._executionsPointsManager.existingPointsChanged().subscribe(this,this.updateAllViews),this._showExecutions=r,this._paneViews.push(new p(e,this))}destroy(){this._executionsPointsManager.existingPointsChanged().unsubscribeAll(this),this._executionsPointsManager.destroy(),this._showExecutions.destroy()}points(){return this._executionsPointsManager.existingPoints()}updateAllViews(){if(this._showExecutions.value())for(const t of this._paneViews)t.update()}paneViews(t){return t.containsMainSeries()?window.TradingView.printing&&!i.enabled("snapshot_trading_drawings")?[]:this._showExecutions.value()?this._paneViews:[]:[]}}},KSBC:function(t,e,o){"use strict";o.r(e),o.d(e,"ExecutionsPointsManager",(function(){return a}));var r=o("Y7w9"),i=o("aIyQ"),s=o.n(i);function l(t){return void 0!==t.index}class a{constructor(t,e,o){this._points=[],this._existingExecutionPointsCache=null,this._offsetOfFirstExistingPoint=null,this._existingPointsChanged=new s.a,this._pointsets=[],this._pointsetManagerFactory=e,this._firstSeriesTimePointWV=o,this._firstSeriesTimePointWV.subscribe(this._updateExistingPoints.bind(this)),this._executionsService=t,this._addPoints(this._executionsService.executions()),this._executionsService.executionsAdded().subscribe(this,this._addPoints),this._executionsService.executionsCleared().subscribe(this,this._clearPoints)}destroy(){this._clearPoints(),this._firstSeriesTimePointWV.destroy(),this._executionsService.executionsAdded().unsubscribeAll(this),this._executionsService.executionsCleared().unsubscribeAll(this),this._executionsService.destroy()}existingPoints(){return null===this._offsetOfFirstExistingPoint?[]:(null===this._existingExecutionPointsCache&&(this._existingExecutionPointsCache=this._points.slice(this._offsetOfFirstExistingPoint).filter(l)),this._existingExecutionPointsCache)}existingPointsChanged(){return this._existingPointsChanged}_onExistingStartPointChanged(){this._existingExecutionPointsCache=null,this._existingPointsChanged.fire(this.existingPoints())}_addPoints(t){if(0===t.length)return;const e=function(t){return t.map(t=>({time_t:Math.round(t.time/1e3),index:void 0,isBuyDirection:1===t.side,tooltip:t.tooltip}))}(t);e.sort((t,e)=>t.time_t-e.time_t);let o=0;const i=this._points.length>0;i&&(o=Object(r.upperbound)(this._points,e[0].time_t,(t,e)=>e.time_t>t,0)),this._points=this._points.slice(0,o).concat(e).concat(this._points.slice(o));const s=this._firstSeriesTimePointWV.value()
;null!==this._offsetOfFirstExistingPoint&&null!==s&&e[0].time_t<s?this._offsetOfFirstExistingPoint=this._offsetOfFirstExistingPoint+e.length:((null===this._offsetOfFirstExistingPoint||e[0].time_t<this._points[this._offsetOfFirstExistingPoint].time_t)&&(this._offsetOfFirstExistingPoint=this._calcOffsetOfFirstExistingPoint()),null!==this._offsetOfFirstExistingPoint&&(i?o>=this._offsetOfFirstExistingPoint&&this._sendPointsToServer(o,o+e.length):this._sendPointsToServer(this._offsetOfFirstExistingPoint,this._points.length)))}_updateExistingPoints(){const t=this._calcOffsetOfFirstExistingPoint();null!==t&&(null===this._offsetOfFirstExistingPoint&&(this._offsetOfFirstExistingPoint=this._points.length),t<this._offsetOfFirstExistingPoint&&(this._sendPointsToServer(t,this._offsetOfFirstExistingPoint),this._offsetOfFirstExistingPoint=t))}_clearPoints(){for(const t of this._pointsets)t.onUpdate().unsubscribeAll(this),t.destroy();this._pointsets=[],this._points=[],this._offsetOfFirstExistingPoint=null,this._onExistingStartPointChanged()}_sendPointsToServer(t,e){const o=this._points.slice(t,e).map(t=>({time_t:t.time_t,offset:0}));if(0===o.length)return;const r=this._pointsetManagerFactory(o);null!==r&&(r.onUpdate().subscribe(this,this._updatePointsFromServer),this._pointsets.push(r))}_updatePointsFromServer(t){if(null===this._offsetOfFirstExistingPoint)return;const e=Object(r.lowerbound)(this._points,t[0].time_t,(t,e)=>t.time_t<e,this._offsetOfFirstExistingPoint);let o=Math.max(this._offsetOfFirstExistingPoint,e);for(const e of t)for(let t=o;t<this._points.length&&(o=t,!(this._points[t].time_t>e.time_t));t++)this._points[t].time_t===e.time_t&&(this._points[t].index=e.index);this._onExistingStartPointChanged()}_calcOffsetOfFirstExistingPoint(){const t=this._firstSeriesTimePointWV.value();return null===t?null:Object(r.upperbound)(this._points,t,(t,e)=>e.time_t>t,0,this._offsetOfFirstExistingPoint||this._points.length)}}},ZvFF:function(t,e,o){"use strict";o.r(e);var r=o("Eyy1"),i=o("ogJP"),s=o("QfUd"),l=o("txPx"),a=o("Cf1E"),n=o("vTIA"),c=o("GOhO"),d=o("oV8k"),h=o("Kxc7"),u=o("ivNn"),_=o("aO4+"),b=o("7KDR"),p=o("5VQP"),v=o("2uTr");async function m(t,e){const o=function(t){const e=[],o=t.modifyOrder;void 0!==o&&e.push(new b.Action({label:P,statName:"Edit Order",onExecute:()=>o("Chart Order Context Menu")}));const r=t.cancelOrder;void 0!==r&&e.push(new b.Action({label:C,statName:"Cancel Order",onExecute:()=>r("Chart Order Context Menu")}));return e}(t);return p.ContextMenuManager.createMenu(o,{}).then(t=>(t.show(e),t))}const P=Object(v.appendEllipsis)(window.t("Modify Order")),C=window.t("Cancel Order");var y=o("cUJV"),g=o("3+Gi"),f=o("0W4x");const x=window.t("Trailing Stop"),w=window.t("Stop Loss"),k=window.t("Take Profit");class S{constructor(t,e,o,r,i,s,l=!1){this._data=null,this._callbacks={},this._quantityFormatter=new y.a,this._inEdit=!1,this._id=t,this._source=o,this._mainSeries=r,this.setData(e),this._symbolDataProvider=i,this._symbolDataProvider.onStatusChanged.subscribe(this,this._updateQtyFormatter),
this._updateQtyFormatter(),this._exitTrackingMode=s,this._isStopLimit=l}destroy(){this._symbolDataProvider.onStatusChanged.unsubscribeAll(this)}data(){return Object(r.ensureNotNull)(this._data)}setData(t){if(this._inEdit)return;const{callbacks:e={},mainType:o,...r}=t;this._callbacks=e,this._data=r}id(){return this._id}price(){return Object(r.ensureNotNull)(this._data).price}qtyText(){const t=Object(r.ensureNotNull)(this._data);return this._quantityFormatter.format(t.considerFilledQty?t.qty-(t.filledQty||0):t.qty)}text(){const t=Object(r.ensureNotNull)(this._data);if(this.isBracket()){const r=(e=t.type,o=t.stopType,3===e?o===g.a.TrailingStop?x:w:1===e?k:null);if(null!==r)return r}var e,o;return`${Object(f.m)(t.side)} ${Object(f.j)(t.type)}`}type(){return Object(r.ensureNotNull)(this._data).type}isActive(){return Object(r.ensureNotNull)(this._data).isActive}isBuyDirection(){return 1===Object(r.ensureNotNull)(this._data).side}supportModify(){return Boolean(this._callbacks.modifyOrder)}async onModify(t="Chart Order"){this._source.setIsBlocked(!0);const e=Object(i.clone)(Object(r.ensureNotNull)(this._data));await this._addTrailingStopPipsData(e),await Object(r.ensureDefined)(this._callbacks.modifyOrder)(t,e.id,e,this._isStopLimit),this._source.setIsBlocked(!1),this._source.syncData()}supportMove(){return Boolean(this._callbacks.moveOrder)}async onMove(t){this._inEdit=!0;const e=new _.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),i=this._mainSeries.firstValue();if(null===i)return;const s=1/this._mainSeries.base(),l=Object(r.ensureNotNull)(this._data),a=o.coordinateToPrice(e.y,i);l.price=Object(u.fixComputationError)(s*Math.round(a/s)),t.isTouch&&this._exitTrackingMode(),this._source.redraw()}async onFinishMove(){this._source.setIsBlocked(!0);const t=Object(i.clone)(Object(r.ensureNotNull)(this._data));if(this._isStopLimit)t.limitPrice=Object(r.ensureNotNull)(this._data).price;else{const e=t.price;t.stopPrice?t.stopPrice=e:t.limitPrice&&(t.limitPrice=e)}await this._addTrailingStopPipsData(t),await Object(r.ensureDefined)(this._callbacks.moveOrder)("Chart Order",t.id,t,this._isStopLimit),this._inEdit=!1,this._source.setIsBlocked(!1),this._source.syncData()}supportClose(){return!this._isStopLimit&&Boolean(this._callbacks.cancelOrder)}async onClose(t="Chart Order"){this._source.isBlocked()||(this._source.setIsBlocked(!0),await Object(r.ensureDefined)(this._callbacks.cancelOrder)(t,Object(r.ensureNotNull)(this._data).id),this._source.setIsBlocked(!1),this._source.syncData())}hasContextMenu(){return null!==this._data&&(this.supportModify()||this.supportClose()||this.supportMove())}onContextMenu(t){if(null!==this._data){const e={};this.supportClose()&&(e.cancelOrder=this.onClose.bind(this)),this.supportModify()&&(e.modifyOrder=this.onModify.bind(this)),m(e,t)}}isBracket(){const t=Object(r.ensureNotNull)(this._data);if(!t.parentId)return!1;const e=this._source.mainItem();return 1!==t.parentType||void 0!==e&&e.data().side!==t.side}async _updateQtyFormatter(){if(null===this._data)return Promise.resolve()
;this._quantityFormatter=await this._symbolDataProvider.quantityFormatter(this._data.symbol),this._source.redraw()}async _addTrailingStopPipsData(t){if(t.parentId&&t.stopType===g.a.TrailingStop){const e=Object(r.ensureDefined)(this._source.mainItem()),{pipSize:o}=await this._symbolDataProvider.symbolInfo(t.symbol),{bid:i,ask:s}=await this._symbolDataProvider.quotesSnapshot(t.symbol),{side:l,type:a,stopPrice:n,limitPrice:c}=e.data();let d;d=e instanceof S?3===a?n:c:1===l?i:s,t.trailingStopPips=(Object(r.ensureDefined)(t.stopPrice||t.limitPrice)-d)/o*(1===l?-1:1)}return t}}async function O(t,e){const o=function(t){const e=[];void 0!==t.modifyPosition&&e.push(new b.Action({label:M,statName:"Modify Position",onExecute:()=>Object(r.ensureDefined)(t.modifyPosition)("Chart Position Context Menu")}));void 0!==t.closePosition&&e.push(new b.Action({label:T,statName:"Close Position",onExecute:()=>Object(r.ensureDefined)(t.closePosition)("Chart Position Context Menu")}));void 0!==t.reversePosition&&e.push(new b.Action({label:I,statName:"Reverse Position",onExecute:()=>Object(r.ensureDefined)(t.reversePosition)("Chart Position Context Menu")}));return e}(t);return p.ContextMenuManager.createMenu(o,{}).then(t=>(t.show(e),t))}const M=Object(v.appendEllipsis)(window.t("Protect Position")),T=window.t("Close Position"),I=window.t("Reverse Position");var D=o("zXvd");const L=Object(l.getLogger)("Trading.Positions");class j{constructor(t,e,o,r,i){this._integerFormatter=new D.NumericFormatter(0),this._oneDecimalFormatter=new D.NumericFormatter(1),this._data=null,this._symbolData={calculatePLUsingLast:!1,minTick:1,pipSize:1,quantityFormatter:null},this._last=null,this._currency=null,this._id=t,this._source=o,this._currencyGetter=i,this.setData(e),this._symbolDataProvider=r,this._updateLastHandler=this._updateLast.bind(this)}destroy(){this.clearRealtime()}data(){return Object(r.ensureNotNull)(this._data)}setData(t){const{callbacks:e,mainType:o,...r}=t;this._callbacks=e,this._data=r}id(){return this._id}price(){return Object(r.ensureNotNull)(this._data).price}qty(){return Object(r.ensureNotNull)(this._data).qtyBySide}currency(){var t;return null!==(t=this._currency)&&void 0!==t?t:""}clearRealtime(){const t=Object(r.ensureNotNull)(this._data);this._symbolDataProvider.unsubscribeRealtime(t.symbol,this._updateLastHandler),this._symbolDataProvider.onStatusChanged.unsubscribeAll(this)}subscribeRealtime(){const t=Object(r.ensureNotNull)(this._data);this._symbolDataProvider.subscribeRealtime(t.symbol,this._updateLastHandler),this._symbolDataProvider.onStatusChanged.subscribe(this,this._updateSymbolData),this._updateSymbolData()}updateCurrency(t){null===this._currency&&(this._currency="",this._currencyGetter(t).then(t=>{this._currency=t,this._source.redraw()}))}isBuyDirection(){return 1===Object(r.ensureNotNull)(this._data).side}supportReverse(){return Object(r.ensureNotNull)(this._data).supportReverse}async onReverse(t){await this._doActionWithBlock("reversePosition",!0,t)}supportClose(){return Object(r.ensureNotNull)(this._data).supportClose}
async onClose(t){await this._doActionWithBlock("closePosition",!0,t)}supportModify(){return Object(r.ensureNotNull)(this._data).supportBrackets}async onModify(t){await this._doActionWithBlock("modifyPosition",!1,t)}hasContextMenu(){return this.supportModify()||this.supportClose()||this.supportReverse()}onContextMenu(t){if(null!==this._data){const e={};this.supportClose()&&(e.closePosition=this.onClose.bind(this)),this.supportReverse()&&(e.reversePosition=this.onReverse.bind(this)),this.supportModify()&&(e.modifyPosition=this.onModify.bind(this)),O(e,t)}}pl(){return Object(r.ensureNotNull)(this._data).pl}displayPl(){if(!this._source.isPositionPLVisible())return null;const{pl:t,side:e,price:o}=Object(r.ensureNotNull)(this._data);if(null===t)return null;const i=this._source.positionDisplayMode();if(i===n.PositionPLDisplay.Money)return 100*t/100||0;const{trade:s,ask:l,bid:a}=this._last||{},c=-1===e;let d=s;this._symbolData.calculatePLUsingLast||(d=c?l:a),d=Number(d||o);const h=(d-o)*(c?-1:1);if(i===n.PositionPLDisplay.Pips){const{pipSize:t,minTick:e}=this._symbolData,o=isFinite(t)&&t!==e?this._oneDecimalFormatter:this._integerFormatter;return parseFloat(o.format(h/(t||e)))}return h/o*100}profitState(){return Object(r.ensureNotNull)(this._data).profitState}_updateLast(t,e){var o,r,i;(this._symbolData.calculatePLUsingLast?(null===(i=this._last)||void 0===i?void 0:i.trade)!==e.trade:(null===(o=this._last)||void 0===o?void 0:o.ask)!==e.ask&&(null===(r=this._last)||void 0===r?void 0:r.bid)!==e.bid)&&(this._last={trade:e.trade||NaN,ask:e.ask||NaN,bid:e.bid||NaN},this._source.positionDisplayMode()!==n.PositionPLDisplay.Money&&this._source.redraw())}async _updateSymbolData(){if(null===this._data)return;const[t,e]=await Promise.all([this._symbolDataProvider.symbolInfo(this._data.symbol),this._symbolDataProvider.quantityFormatter(this._data.symbol)]);this._symbolData.minTick=t.minTick,this._symbolData.pipSize=t.pipSize,this._symbolData.quantityFormatter=e;const o=this._symbolDataProvider.activeBroker();this._symbolData.calculatePLUsingLast=(null==o?void 0:o.metainfo().configFlags.calculatePLUsingLast)||!1,this._source.positionDisplayMode()!==n.PositionPLDisplay.Money&&this._source.redraw()}async _doActionWithBlock(t,e,o="Chart Position"){if(void 0!==this._callbacks[t]&&null!==this._data){e&&this._source.setIsBlocked(!0);try{await Object(r.ensureDefined)(this._callbacks[t])(o,this._data.id)}catch(e){L.logWarn(`Try to ${t}, but got error: ${Object(a.a)(e)}`)}finally{e&&(this._source.setIsBlocked(!1),this._source.syncData())}}}}var R=o("YFKU"),A=o("EBrf"),V=o("Ialn"),B=o("Tmoa"),N=o("972a"),E=o("HGP3")
;const F=Object(B.generateColor)(E.colorsPalette["color-tv-blue-500"],85),W=Object(B.generateColor)(E.colorsPalette["color-tv-blue-500"],80),H=Object(B.generateColor)(E.colorsPalette["color-ripe-red-500"],85),q=Object(B.generateColor)(E.colorsPalette["color-ripe-red-500"],80),U=Object(B.generateColor)(E.colorsPalette["color-minty-green-500"],85),z=Object(B.generateColor)(E.colorsPalette["color-minty-green-500"],80),G=Object(B.generateColor)(E.colorsPalette["color-tan-orange-500"],85),Q=Object(B.generateColor)(E.colorsPalette["color-tan-orange-500"],80),Y={buy:{normal:{labelTickColor:E.colorsPalette["color-tv-blue-500"],lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-tv-blue-a700"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-a800"],activeColor:F},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:E.colorsPalette["color-tv-blue-500"],activeColor:F}},disabled:{labelTickColor:E.colorsPalette["color-tv-blue-500"],lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-tv-blue-a700"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-a800"],activeColor:F},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:W,activeColor:F}}},sell:{normal:{labelTickColor:E.colorsPalette["color-ripe-red-500"],lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-ripe-red-a800"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-a800"],activeColor:H},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:E.colorsPalette["color-ripe-red-500"],activeColor:H}},disabled:{labelTickColor:E.colorsPalette["color-ripe-red-500"],lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-ripe-red-a800"],qty:{
backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-a800"],activeColor:H},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:q,activeColor:H}}},takeProfit:{normal:{labelTickColor:E.colorsPalette["color-minty-green-500"],lineColor:E.colorsPalette["color-minty-green-500"],borderColor:E.colorsPalette["color-minty-green-500"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:"#0D3D41",activeColor:U},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:"#0D3D41"},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:E.colorsPalette["color-minty-green-500"],activeColor:U}},disabled:{labelTickColor:E.colorsPalette["color-minty-green-500"],lineColor:E.colorsPalette["color-minty-green-500"],borderColor:E.colorsPalette["color-minty-green-500"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:"#0D3D41",activeColor:U},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:"#0D3D41"},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:z,activeColor:U}}},stopLoss:{normal:{labelTickColor:E.colorsPalette["color-tan-orange-500"],lineColor:E.colorsPalette["color-tan-orange-500"],borderColor:E.colorsPalette["color-tan-orange-500"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:"#453826",activeColor:G},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:"#453826"},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:E.colorsPalette["color-tan-orange-500"],activeColor:G}},disabled:{labelTickColor:E.colorsPalette["color-tan-orange-500"],lineColor:E.colorsPalette["color-tan-orange-500"],borderColor:E.colorsPalette["color-tan-orange-500"],qty:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:"#453826",activeColor:G},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:"#453826"},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:Q,activeColor:G}}}},K={buy:{normal:{labelTickColor:E.colorsPalette["color-tv-blue-500"],lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-tv-blue-100"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tv-blue-500"],
dividerColor:E.colorsPalette["color-tv-blue-50"],activeColor:F},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:E.colorsPalette["color-tv-blue-500"],activeColor:F}},disabled:{labelTickColor:E.colorsPalette["color-tv-blue-500"],lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-tv-blue-100"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-50"],activeColor:F},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tv-blue-500"],dividerColor:E.colorsPalette["color-tv-blue-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:W,activeColor:F}}},sell:{normal:{labelTickColor:E.colorsPalette["color-ripe-red-500"],lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-ripe-red-100"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-50"],activeColor:H},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:E.colorsPalette["color-ripe-red-500"],activeColor:H}},disabled:{labelTickColor:E.colorsPalette["color-ripe-red-500"],lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-ripe-red-100"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-50"],activeColor:H},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:q,activeColor:H}}},takeProfit:{normal:{labelTickColor:E.colorsPalette["color-minty-green-500"],lineColor:E.colorsPalette["color-minty-green-500"],borderColor:E.colorsPalette["color-minty-green-500"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:E.colorsPalette["color-minty-green-50"],activeColor:U},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:E.colorsPalette["color-minty-green-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:E.colorsPalette["color-minty-green-500"],activeColor:U}},disabled:{labelTickColor:E.colorsPalette["color-minty-green-500"],
lineColor:E.colorsPalette["color-minty-green-500"],borderColor:E.colorsPalette["color-minty-green-500"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:E.colorsPalette["color-minty-green-50"],activeColor:U},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-minty-green-500"],dividerColor:E.colorsPalette["color-minty-green-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:z,activeColor:U}}},stopLoss:{normal:{labelTickColor:E.colorsPalette["color-tan-orange-500"],lineColor:E.colorsPalette["color-tan-orange-500"],borderColor:E.colorsPalette["color-tan-orange-500"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:E.colorsPalette["color-tan-orange-50"],activeColor:G},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:E.colorsPalette["color-tan-orange-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:E.colorsPalette["color-tan-orange-500"],activeColor:G}},disabled:{labelTickColor:E.colorsPalette["color-tan-orange-500"],lineColor:E.colorsPalette["color-tan-orange-500"],borderColor:E.colorsPalette["color-tan-orange-500"],qty:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:E.colorsPalette["color-tan-orange-50"],activeColor:G},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-tan-orange-500"],dividerColor:E.colorsPalette["color-tan-orange-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:Q,activeColor:G}}}};function J(t,e,o){const r=o()?Y:K;let i;i=t.isBracket()?1===t.type()?r.takeProfit:r.stopLoss:t.isBuyDirection()?r.buy:r.sell;return{...e.isBlocked()?i.disabled:i.normal,lineStyle:t.isActive()?N.b.Solid:N.b.Dotted,borderStyle:t.isActive()?N.b.Solid:N.b.Dotted,labelBorderVisible:!0}}const X={buy:{normal:{lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-tv-blue-a700"],qty:{backgroundColor:E.colorsPalette["color-tv-blue-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-tv-blue-500"],activeColor:E.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-cold-gray-600"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-tv-blue-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:E.colorsPalette["color-tv-blue-500"],activeColor:F},reverse:{backgroundColor:E.colorsPalette["color-cold-gray-900"],borderColor:E.colorsPalette["color-tv-blue-500"],iconColor:E.colorsPalette["color-tv-blue-500"],activeColor:F}},disabled:{lineColor:E.colorsPalette["color-tv-blue-500"],
borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-tv-blue-a700"],qty:{backgroundColor:E.colorsPalette["color-tv-blue-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-tv-blue-500"],activeColor:E.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-cold-gray-600"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-tv-blue-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:W,activeColor:F},reverse:{backgroundColor:E.colorsPalette["color-cold-gray-900"],borderColor:E.colorsPalette["color-tv-blue-500"],iconColor:W,activeColor:F}}},sell:{normal:{lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-ripe-red-a800"],qty:{backgroundColor:E.colorsPalette["color-ripe-red-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-ripe-red-500"],activeColor:E.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-cold-gray-600"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:E.colorsPalette["color-ripe-red-500"],activeColor:H},reverse:{backgroundColor:E.colorsPalette["color-cold-gray-900"],borderColor:E.colorsPalette["color-ripe-red-500"],iconColor:E.colorsPalette["color-ripe-red-500"],activeColor:H}},disabled:{lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-cold-gray-900"],disabledLineColor:E.colorsPalette["color-ripe-red-a800"],qty:{backgroundColor:E.colorsPalette["color-ripe-red-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-ripe-red-500"],activeColor:E.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:E.colorsPalette["color-cold-gray-900"],textColor:E.colorsPalette["color-cold-gray-600"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-a800"]},close:{backgroundColor:E.colorsPalette["color-cold-gray-900"],iconColor:q,activeColor:H},reverse:{backgroundColor:E.colorsPalette["color-cold-gray-900"],borderColor:E.colorsPalette["color-ripe-red-500"],iconColor:q,activeColor:H}}}},$={buy:{normal:{lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-tv-blue-100"],qty:{
backgroundColor:E.colorsPalette["color-tv-blue-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-tv-blue-500"],activeColor:E.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-cold-gray-300"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-tv-blue-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:E.colorsPalette["color-tv-blue-500"],activeColor:F},reverse:{backgroundColor:E.colorsPalette["color-white"],borderColor:E.colorsPalette["color-tv-blue-500"],iconColor:E.colorsPalette["color-tv-blue-500"],activeColor:F}},disabled:{lineColor:E.colorsPalette["color-tv-blue-500"],borderColor:E.colorsPalette["color-tv-blue-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-tv-blue-100"],qty:{backgroundColor:E.colorsPalette["color-tv-blue-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-tv-blue-500"],activeColor:E.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-cold-gray-300"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-tv-blue-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:W,activeColor:E.colorsPalette["color-tv-blue-50"]},reverse:{backgroundColor:E.colorsPalette["color-white"],borderColor:E.colorsPalette["color-tv-blue-500"],iconColor:W,activeColor:F}}},sell:{normal:{lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-ripe-red-100"],qty:{backgroundColor:E.colorsPalette["color-ripe-red-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-ripe-red-500"],activeColor:E.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-cold-gray-300"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:E.colorsPalette["color-ripe-red-500"],activeColor:H},reverse:{backgroundColor:E.colorsPalette["color-white"],borderColor:E.colorsPalette["color-ripe-red-500"],iconColor:E.colorsPalette["color-ripe-red-500"],activeColor:H}},disabled:{lineColor:E.colorsPalette["color-ripe-red-500"],borderColor:E.colorsPalette["color-ripe-red-500"],pointBackgroundColor:E.colorsPalette["color-white"],disabledLineColor:E.colorsPalette["color-ripe-red-100"],qty:{backgroundColor:E.colorsPalette["color-ripe-red-500"],textColor:E.colorsPalette["color-white"],dividerColor:E.colorsPalette["color-ripe-red-500"],activeColor:E.colorsPalette["color-ripe-red-600"]},
text:{backgroundColor:E.colorsPalette["color-white"],textColor:E.colorsPalette["color-cold-gray-300"],positiveTextColor:E.colorsPalette["color-minty-green-500"],negativeTextColor:E.colorsPalette["color-ripe-red-500"],dividerColor:E.colorsPalette["color-ripe-red-50"]},close:{backgroundColor:E.colorsPalette["color-white"],iconColor:q,activeColor:H},reverse:{backgroundColor:E.colorsPalette["color-white"],borderColor:E.colorsPalette["color-ripe-red-500"],iconColor:q,activeColor:H}}}};function Z(t,e,o){const r=o()?X:$,i=t.isBuyDirection()?r.buy:r.sell;return{...e.isBlocked()?i.disabled:i.normal,lineStyle:N.b.Solid,borderStyle:N.b.Solid,labelBorderVisible:!1}}var tt=o("zDbI"),et=o("jFln"),ot=o("XlJ7"),rt=o("gAom"),it=o("u+0B"),st=o("ikwP"),lt=o("VdBB"),at=o("//lt");function nt(t,e,o,r,i,s,l,a){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=l,t.font=a,t.translate(r,i+s),Object(st.drawScaled)(t,e,()=>{t.fillText(o,0,0)}),t.restore()}function ct(t,e,o,r,i,s){t.save(),t.fillStyle=s,t.fillRect(e,o,r,i),t.restore()}let dt;class ht{constructor(t,e,o){this._data=null,this._height=19,this._heightBody=19,this._bodyBorderRadius=2,this._font=null,this._cache=null,this._wasSourceMoved=!1,this._textWidthCache=e,this._data=t,this._font=o}setFont(t){this._font!==t&&(this._font=t,this.clearCache())}data(){return this._data}clearCache(){this._cache=null}hitTest(t,e){if(null===this._data)return null;const o=this.rect(e),r=e.pixelRatio,i=Math.round(t.x*r),s=Math.round(t.y*r),l=i>=o.body.left,a=i<=o.body.right,n=l&&a;if(!(s>=o.top&&s<=o.bottom)||!n)return null;const c={cursorType:at.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,activeItem:{id:this._data.id,part:4}};if(this._data.disabled)return new lt.HitTestResult(lt.HitTestResult.CUSTOM,c);let d={};if(void 0!==this._data.callbacks.onMove){const t=t=>{var e;(null===(e=this._data)||void 0===e?void 0:e.callbacks.onMove)&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},e=()=>{var t;this._wasSourceMoved&&(null===(t=this._data)||void 0===t?void 0:t.callbacks.onFinishMove)&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};d={activeItem:{id:this._data.id,part:4},cursorType:at.PaneCursorType.Pointer,pressedMouseMoveHandler:t,touchMoveHandler:t,mouseUpHandler:e,touchEndHandler:e}}const h=this._data.callbacks.onContextMenu,u={...c,...d,contextMenuHandler:h},_=Math.round(o.body.left/r),b=Math.round(o.top/r);if(l&&i<o.text.left&&void 0!==this._data.callbacks.onModify){const t=Math.round(o.text.left/r);return new lt.HitTestResult(lt.HitTestResult.CUSTOM,{...u,activeItem:{id:this._data.id,part:1},cursorType:at.PaneCursorType.Default,clickHandler:this._data.callbacks.onModify,tapHandler:this._data.callbacks.onModify,tooltip:{extendMargin:!0,text:this._data.qty.title,rect:{x:_,y:b,w:t-_,h:this._height}}})}if(i>=o.close.left&&a&&void 0!==this._data.callbacks.onClose){const t=Math.round(o.body.right/r),e=Math.round(o.close.left/r);return new lt.HitTestResult(lt.HitTestResult.CUSTOM,{...u,activeItem:{id:this._data.id,part:2},cursorType:at.PaneCursorType.Default,
clickHandler:this._data.callbacks.onClose,tapHandler:this._data.callbacks.onClose,tooltip:{extendMargin:!0,text:this._data.close.title,rect:{x:e,y:b,w:t-e,h:this._height}}})}return new lt.HitTestResult(lt.HitTestResult.CUSTOM,u)}drawBackground(t,e){null===this._data||this._data.line.drawOnTop||this._drawLine(t,e)}drawLine(t,e){this._isDataVisibleInViewport(e)&&null!==this._data&&this._data.line.drawOnTop&&this._drawLine(t,e)}drawPointOnLine(t,e,o){if(!this._isDataVisibleInViewport(e)||null===this._data||!this._data.point.visible)return;const r=this.rect(e),i=Math.round(3*e.pixelRatio),s=Math.max(1,Math.floor(1*e.pixelRatio)),l=s/2,a=2.5*e.pixelRatio+l,n=o+(l%1==0?0:.5),c=r.yMid+(l%1==0?0:.5);t.save(),t.lineWidth=s,Object(et.setLineStyle)(t,this._data.point.borderStyle),this._data.point.shadowColor&&!this._data.disabled&&(t.fillStyle=this._data.point.shadowColor,Object(rt.createCircle)(t,n,c,a+i),t.fill()),t.strokeStyle=this._data.point.borderColor,t.fillStyle=this._data.point.backgroundColor,Object(rt.createCircle)(t,n,c,a),t.fill(),t.stroke(),t.restore()}draw(t,e){if(null===this._data)return;const o=e.pixelRatio,r=this.rect(e);if(!this._isDataVisibleInViewport(e))return;const i=r.body.right-r.body.left,s=r.body.bottom-r.body.top,l=r.body.top+r.borderWidth,a=s-2*r.borderWidth,n=r.borderRadius-r.borderWidth;Object(rt.drawRoundRectWithInnerBorder)(t,r.body.left,r.body.top,i,s,"transparent",r.borderRadius,r.borderWidth,this._data.borderColor,this._data.borderStyle);const c=(r.body.top+r.body.bottom)/2;let d=r.body.left+r.borderWidth;const h=0!==r.text.width,u=0!==r.close.width;if(0!==r.qty.width){const e=this._data.qty.active,i=h||u?[n,0,0,n]:n;Object(rt.drawRoundRectWithInnerBorder)(t,r.qty.left,l,r.qty.width,a,this._data.qty.backgroundColor,i),e.visible&&Object(rt.drawRoundRectWithInnerBorder)(t,r.qty.left,l,r.qty.width,a,e.backgroundColor,i);const s=r.qty.left+r.qty.width/2;this._drawQuantityText(t,o,s,c),d+=r.qty.width,ct(t,d,l,r.borderWidth,a,this._data.qty.dividerColor),d+=r.borderWidth}if(h){const e=u?0:[0,n,n,0];Object(rt.drawRoundRectWithInnerBorder)(t,r.text.left,l,r.text.width,a,this._data.text.backgroundColor,e);const i=r.text.left+r.text.width/2;this._drawBodyText(t,o,i,c),d+=r.text.width,ct(t,d,l,r.borderWidth,a,this._data.text.dividerColor),d+=r.borderWidth}if(u){const e=r.body.right-d-r.borderWidth,i=this._data.close.active;Object(rt.drawRoundRectWithInnerBorder)(t,d,l,e,a,this._data.close.backgroundColor,[0,n,n,0]),i.visible&&Object(rt.drawRoundRectWithInnerBorder)(t,d,l,e,a,i.backgroundColor,[0,n,n,0]),this._drawCloseButton(t,o,d,r.body.top,r.close.width,s,r.borderWidth)}}rect(t){return null===this._cache&&(dt||function(){const t=document.createElement("canvas");t.width=0,t.height=0,dt=Object(r.ensureNotNull)(t.getContext("2d"))}(),this._cache=this._calculateCacheRect(t)),Object(r.ensureNotNull)(this._cache)}_calculateCacheRect(t){
const e=t.pixelRatio,o=Math.round(t.cssWidth*e),i=Object(r.ensureNotNull)(this._data),s=Math.max(1,Math.floor(1*e)),l=this._bodyBorderRadius,a=Math.max(l,Math.floor(l*e)),c=this._quantityWidth(dt),d=Math.round(c*e),h=this._textWidth(dt),u=Math.round(h*e),_=i.callbacks.onClose?this._closeWidth():0,b=Math.round(_*e),p=s*((c&&1)+(h&&1)),v=d+u+b+p+2*s,m=this._calcAllWidth(t.pixelRatio,d,u,b,p,s);let P=Math.round(this._heightBody*e);const C=Math.max(1,Math.floor(e));P%2!=C%2&&(P+=1);const y=Math.round(i.y*e),g=Math.floor(y+C/2-P/2)-Math.floor(.5*e),f=Math.round((this._height-this._heightBody)/2*e),x=g-f,w=P+2*f,k=o-m;let S=0;if(void 0!==i.line.width){const t=Math.round(i.line.width*e);S=Math.max(t/100*o,1)}else switch(i.bodyAlignment){case n.TradingSourcesHorizontalAlignment.Left:S=o;break;case n.TradingSourcesHorizontalAlignment.Right:S=Math.round(40*e);break;case n.TradingSourcesHorizontalAlignment.Center:S=k/2}const O=Math.round(o-Math.min(k,S)),M=O-v,T=M+d+(d&&s)+(d&&s);return{borderWidth:s,borderRadius:a,yMid:y,top:x,bottom:x+w,left:0,right:o,body:{left:M,right:O,top:g,bottom:g+P},qty:{width:d,left:M+(d&&s)},text:{width:u,left:T},close:{width:b,left:T+u+(u&&s)}}}_calcAllWidth(t,e,o,r,i,s){return e+o+r+i+2*s}_isDataVisibleInViewport(t){if(null===this._data)return!1;const e=Math.ceil(this._height/2);return this._data.y>=-e&&this._data.y<=t.cssHeight+e}_drawLine(t,e){const o=Object(r.ensureNotNull)(this._data),i=e.pixelRatio,s=this.rect(e),l=Math.round(e.physicalWidth);t.save(),t.strokeStyle=o.line.color,t.lineWidth=Math.max(1,Math.floor(o.line.thickness*i)),Object(et.setLineStyle)(t,o.line.style),Object(rt.drawHorizontalLine)(t,s.yMid,s.body.right,l),o.line.extend&&Object(rt.drawHorizontalLine)(t,s.yMid,0,s.body.left),t.restore()}_textWidth(t){const e=Object(r.ensureNotNull)(this._data);t.save(),t.font=Object(r.ensureNotNull)(this._font);const o=Math.ceil(this._textWidthCache.measureText(t,e.text.text));return t.restore(),o?Math.round(14+o):0}_closeWidth(){return 23}_drawBodyText(t,e,o,i){const s=Object(r.ensureNotNull)(this._data).text,l=this._textWidthCache.yMidCorrection(t,Object(r.ensureNotNull)(this._data).qty.text)*e;nt(t,e,s.text,o,i,l,s.textColor,Object(r.ensureNotNull)(this._font))}_drawQuantityText(t,e,o,i){const s=Object(r.ensureNotNull)(this._data).qty,l=this._textWidthCache.yMidCorrection(t,s.text)*e;nt(t,e,s.text,o,i,l,s.textColor,Object(r.ensureNotNull)(this._font))}_drawCloseButton(t,e,o,i,s,l,a){const n=Object(r.ensureNotNull)(this._data).close;t.save(),t.lineWidth=a,t.strokeStyle=n.iconColor;const c=i+l,d=Math.max(1,Math.ceil(7*e)),h=Math.round((s-d)/2),u=Math.round((l-d)/2);Object(et.drawPoly)(t,[new _.Point(o+h,i+u),new _.Point(o+h+d,c-u)],!0),Object(et.drawPoly)(t,[new _.Point(o+h+d,i+u),new _.Point(o+h,c-u)],!0),t.restore()}_quantityWidth(t){const e=Object(r.ensureNotNull)(this._data);t.save(),t.font=Object(r.ensureNotNull)(this._font);const o=Math.ceil(this._textWidthCache.measureText(t,e.qty.text));return t.restore(),Math.round(Math.max(this._height,14+o))}}var ut=o("//HS");class _t extends ht{
constructor(){super(...arguments),this._height=19,this._heightBody=19,this._bodyBorderRadius=2,this._lastTextWidth=0}hitTest(t,e){if(null===this._data)return null;const o=e.pixelRatio,r=this.rect(e),i=Math.round(t.x*o),s=Math.round(t.y*o),l=i>=r.reverse.left,a=i<=r.body.right,n=l&&a,c=s>=r.top&&s<=r.bottom,d=Math.round(r.top/o);if(!c||!n)return null;const h={cursorType:at.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,activeItem:{id:this._data.id,part:4}};if(this._data.disabled)return new lt.HitTestResult(lt.HitTestResult.CUSTOM,h);if(void 0!==this._data.callbacks.onReverse&&this._data.reverse.visible){const t=r.reverse.left+r.reverse.width;if(i>=r.reverse.left&&i<t){const t=Math.round(r.reverse.left/o),e=Math.round(r.reverse.width/o);return new lt.HitTestResult(lt.HitTestResult.CUSTOM,{activeItem:{id:this._data.id,part:3},cursorType:at.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,contextMenuHandler:this._data.callbacks.onContextMenu,clickHandler:this._data.callbacks.onReverse,tapHandler:this._data.callbacks.onReverse,tooltip:{text:this._data.reverse.title,rect:{x:t,y:d,w:e,h:this._height}}})}if(i>=t&&i<r.body.left)return new lt.HitTestResult(lt.HitTestResult.CUSTOM,h)}return super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isReverseVisible()||!this._isDataVisibleInViewport(e))return;const o=this.rect(e);this._drawReverseButton(t,e.pixelRatio,o.reverse.left,o.top,o.reverse.width,o.bottom-o.top,o.borderWidth,o.borderRadius)}rect(t){return super.rect(t)}_drawLine(t,e){var o;if(!(null===(o=this._data)||void 0===o?void 0:o.callbacks.onReverse))return void super._drawLine(t,e);const i=Object(r.ensureNotNull)(this._data),s=e.pixelRatio,l=this.rect(e),a=Math.round(e.physicalWidth),n=l.reverse.left+l.reverse.width;if(t.save(),t.strokeStyle=i.line.color,t.lineWidth=Math.max(1,Math.floor(i.line.thickness*s)),Object(et.setLineStyle)(t,i.line.style),Object(rt.drawHorizontalLine)(t,l.yMid,l.body.right,a),this._isReverseVisible()&&Object(rt.drawHorizontalLine)(t,l.yMid,n,l.body.left),i.line.extend){const e=this._isReverseVisible()?l.reverse.left:l.body.left;Object(rt.drawHorizontalLine)(t,l.yMid,0,e)}t.restore()}_calculateCacheRect(t){const e=super._calculateCacheRect(t),o=Math.round(29*t.pixelRatio),r=e.body.left-o-Math.round(10*t.pixelRatio);return{...e,reverse:{width:o,left:r}}}_calcAllWidth(t,e,o,r,i,s){var l;const a=super._calcAllWidth(t,e,o,r,i,s);if(!(null===(l=this._data)||void 0===l?void 0:l.callbacks.onReverse))return a;return a+Math.round(29*t)+Math.round(10*t)}_textWidth(t){const e=Object(r.ensureNotNull)(this._data);if(!e.text.text)return 0;t.save(),t.font=Object(r.ensureNotNull)(this._font);const o=Math.ceil(this._textWidthCache.measureText(t,e.text.text));if(o>this._lastTextWidth){const e=Math.ceil(this._textWidthCache.measureText(t,"0"));this._lastTextWidth=o+e}return t.restore(),Math.round(14+this._lastTextWidth)}_closeWidth(){return 23}_drawReverseButton(t,e,o,i,s,l,a,n){const c=Object(r.ensureNotNull)(this._data),d=c.reverse,h=d.active;t.save(),
Object(rt.drawRoundRectWithInnerBorder)(t,o,i,s,l,d.backgroundColor,n,a,c.borderColor),h.visible&&Object(rt.drawRoundRectWithInnerBorder)(t,o,i,s,l,h.backgroundColor,n,a,"transparent");const u=Math.round(3*e),_=Math.round(3*e),b=Math.round(9*e),p=Math.round(o+(s-u)/2),v=Math.round(p+u),m=Math.round(i+a+4*e),P=m+b,C=d.iconColor;t.lineWidth=a,Object(ut.b)(t,p,m,C,!1,b,_),Object(ut.b)(t,v,P,C,!0,b,_),t.restore()}_isReverseVisible(){return null!==this._data&&(Boolean(this._data.callbacks.onReverse)&&this._data.reverse.visible)}}class bt{constructor(){this._prevCssWidth=null,this._prevPixelRatio=null,this._prevFontSize=null,this._font=null,this._itemsRectsInfo=null,this._textWidthCache=new it.TextWidthCache,this._tradedItems=[],this._vertLineData=null}setVertLineData(t){this._vertLineData=t}setFontSize(t){if(this._prevFontSize!==t){this._checkCacheValid({pixelRatio:this._prevPixelRatio,cssWidth:this._prevCssWidth},t),this._prevFontSize=t,this._font=null===t?null:Object(ot.makeFont)(t,tt.CHART_FONT_FAMILY,"","normal");for(const t of this._tradedItems)t.setFont(this._font)}}clearItems(){this._tradedItems=[],this._itemsRectsInfo=null}addItem(t){let e;e=t.hasOwnProperty("reverse")?new _t(t,this._textWidthCache,this._font):new ht(t,this._textWidthCache,this._font),this._tradedItems.push(e),this._itemsRectsInfo=null}hitTest(t,e){if(!this._tradedItems.length)return null;for(let o=this._tradedItems.length-1;o>=0;o--){const r=this._tradedItems[o].hitTest(t,e);if(null!==r)return r}return null}drawBackground(t,e){this._checkCacheValid(e,this._prevFontSize);for(const o of this._tradedItems)o.drawBackground(t,e)}draw(t,e){var o;this._checkCacheValid(e,this._prevFontSize),this._calcItemsRectsInfo(e);for(const o of this._tradedItems)o.drawLine(t,e);const i=(null===(o=this._itemsRectsInfo)||void 0===o?void 0:o.rightmostBorder)||null,s=Math.round(e.cssWidth*e.pixelRatio),l=Math.round(20*e.pixelRatio);if(null!==i&&i+l<s){const o=Math.round(13*e.pixelRatio),i=Object(r.ensureNotNull)(this._itemsRectsInfo).rightmostBorder+o;this._drawVertLine(t,e,i);for(const o of this._tradedItems)o.drawPointOnLine(t,e,i)}for(const o of this._tradedItems)o.draw(t,e)}_checkCacheValid(t,e){const o=this._prevFontSize!==e||this._prevPixelRatio!==t.pixelRatio,r=this._prevCssWidth!==t.cssWidth;if(o||r){o&&this._textWidthCache.reset(),this._itemsRectsInfo=null;for(const t of this._tradedItems)t.clearCache()}}_calcItemsRectsInfo(t){if(null!==this._itemsRectsInfo||!this._tradedItems.length)return;const e=this._tradedItems.map(e=>e.rect(t));let o=e[0].body.right,r=e[0].yMid,i=e[0].yMid;for(const t of e)t.body.right>o&&(o=t.body.right),t.yMid<r&&(r=t.yMid),t.yMid>i&&(i=t.yMid);this._itemsRectsInfo={rightmostBorder:o,yMin:r,yMax:i}}_drawVertLine(t,e,o){const r=this._vertLineData;if(null===r||null===this._itemsRectsInfo||this._itemsRectsInfo.yMax===this._itemsRectsInfo.yMin)return;const i=e.pixelRatio;t.strokeStyle=r.color,t.lineWidth=Math.max(1,Math.floor(r.thickness*i)),Object(et.setLineStyle)(t,r.style),
Object(rt.drawVerticalLine)(t,o,this._itemsRectsInfo.yMin,this._itemsRectsInfo.yMax)}}function pt(t,e,o,i){if(null===e)return"";const s=Object(r.ensureNotNull)(t),l=Math.abs(e),a=o!==n.PositionPLDisplay.Pips?l.toFixed(2):l,c=Object(A.splitThousands)(a," "),d=s>0?"+ "+c:s<0?"− "+c:c;let h;switch(o){case n.PositionPLDisplay.Money:h=i?`${d} ${i}`:d;break;case n.PositionPLDisplay.Pips:h=wt.format({pips:d});break;case n.PositionPLDisplay.Percentage:h=d+"%"}return Object(V.startWithLTR)(h)}function vt(t){return null===t?"0":Object(V.forceLTRStr)(Object(A.splitThousands)(t," "))}function mt(t){return t instanceof j}function Pt(t){const e={};return mt(t)&&t.supportReverse()&&(e.onReverse=t.onReverse.bind(t)),t.supportClose()&&(e.onClose=t.onClose.bind(t)),t.supportModify()&&(e.onModify=t.onModify.bind(t)),!mt(t)&&t.supportMove()&&(e.onMove=t.onMove.bind(t),e.onFinishMove=t.onFinishMove.bind(t)),t.hasContextMenu()&&(e.onContextMenu=t.onContextMenu.bind(t)),e}const Ct=Object(R.t)("Modify Order..."),yt=Object(R.t)("Cancel Order"),gt=Object(v.appendEllipsis)(Object(R.t)("Protect Position")),ft=Object(R.t)("Reverse Position"),xt=Object(R.t)("Close Position"),wt=Object(R.t)("{pips} pips");class kt{constructor(t,e){this._invalidated=!0,this._chartModel=t,this._source=e,this._showOrderProperty=e.showOrderProperty(),this._showPositionProperty=e.showPositionProperty(),this._renderer=new bt,this._renderer.setFontSize(13)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}priceToCoordinate(t){if(null===t)return null;const e=this._chartModel.mainSeries(),o=e.firstValue();return null===o?null:e.priceScale().priceToCoordinate(t,o)}_isHoveredSource(){return this._chartModel.hoveredSource()===this._source}_isHoveredOtherTradedSource(){return!this._isHoveredSource()&&this._chartModel.hoveredSource()instanceof Lt}_isSelectedSource(){return this._chartModel.selection().isSelected(this._source)}_isHoveredItem(t){var e;return(null===(e=this._source.hoveredItem())||void 0===e?void 0:e.id)===t.id()}_isHoveredItemPart(t,e){var o;return this._isHoveredItem(t)&&(null===(o=this._source.hoveredItem())||void 0===o?void 0:o.part)===e}_isSelectedItem(t){var e;return(null===(e=this._source.selectedItem())||void 0===e?void 0:e.id)===t.id()}_sortedItems(){const t=[],e=this._source.tradedItems();let o=null,r=null;const i=e.brackets.slice();void 0!==e.main&&i.push(e.main),void 0!==e.stopLimit&&i.push(e.stopLimit);for(const e of i)this._isHoveredItem(e)?r=e:this._isSelectedItem(e)?o=e:t.push(e);return null!==o&&t.push(o),null!==r&&t.push(r),t}_updateImpl(){if(this._renderer.clearItems(),!this._showOrderProperty.value()||!this._showPositionProperty.value()||this._isNoData())return;let t=null;const e=this._mainItemStyle(),o=this._isSelectedSource(),i=o&&this._isHoveredOtherTradedSource()?Object(r.ensureDefined)(e.disabledLineColor):e.lineColor;(this._isHoveredSource()||o)&&(t={thickness:this._source.lineWidth(),style:e.lineStyle,color:i}),this._renderer.setVertLineData(t)
;for(const t of this._sortedItems()){const o=this.priceToCoordinate(t.price());if(null===o)continue;let r;r=mt(t)?this._rendererDataForPositionItem(t,o,i):this._rendererDataForOrderItem(t,e,o,i),null!==r&&this._renderer.addItem(r)}}_isNoData(){const t=this._source.tradedItems();return void 0===t.main&&void 0===t.stopLimit&&0===t.brackets.length}_rendererDataForOrderItem(t,e,o,i){if(!this._showOrderProperty.value())return null;const s=J(t,this._source,()=>this._chartModel.isDark()),l=this._isHoveredSource()||this._isSelectedSource(),a=this._isHoveredItemPart(t,1),n=this._isHoveredItemPart(t,2),c=Object(B.generateColor)(s.borderColor,85),d=this._isHoveredItem(t)?Object(B.generateColor)(e.borderColor,80):void 0;return{borderColor:s.borderColor,borderStyle:s.borderStyle,bodyAlignment:void 0,y:o,id:t.id(),disabled:this._source.isBlocked(),callbacks:Pt(t),line:{drawOnTop:l,thickness:this._source.lineWidth(),width:this._source.lineLength(),style:s.lineStyle,color:s.lineColor,extend:this._source.isLineExtended()},qty:{title:Ct,text:vt(t.qtyText()),textColor:s.qty.textColor,backgroundColor:s.qty.backgroundColor,dividerColor:s.qty.dividerColor,active:{visible:a,backgroundColor:c}},text:{text:t.text(),textColor:s.text.textColor,backgroundColor:s.text.backgroundColor,dividerColor:s.text.dividerColor},close:{title:yt,backgroundColor:s.close.backgroundColor,iconColor:s.close.iconColor,active:{visible:n,backgroundColor:c}},point:{visible:l,backgroundColor:this._isSelectedItem(t)?i:Object(r.ensureDefined)(e.pointBackgroundColor),borderStyle:e.lineStyle,borderColor:i,shadowColor:d}}}_rendererDataForPositionItem(t,e,o){if(!this._showPositionProperty.value())return null;const i=this._source.positionDisplayMode(),s=Z(t,this._source,()=>this._chartModel.isDark()),l=s.reverse,a=this._isHoveredSource()||this._isSelectedSource(),n=this._isHoveredItemPart(t,1),c=this._isHoveredItemPart(t,2),d=this._isHoveredItemPart(t,3),h=(this._isHoveredItem(t)||this._isSelectedItem(t),this._isHoveredItem(t)?Object(B.generateColor)(s.borderColor,80):void 0);return{borderColor:s.borderColor,borderStyle:s.borderStyle,bodyAlignment:void 0,y:e,id:t.id(),disabled:this._source.isBlocked(),callbacks:Pt(t),line:{drawOnTop:a,thickness:this._source.lineWidth(),width:this._source.lineLength(),style:s.lineStyle,color:s.lineColor,extend:this._source.isLineExtended()},qty:{title:gt,text:vt(t.qty()),textColor:s.qty.textColor,backgroundColor:s.qty.backgroundColor,dividerColor:s.qty.dividerColor,active:{visible:n,backgroundColor:s.qty.activeColor}},text:{text:pt(t.pl(),t.displayPl(),i,t.currency()),textColor:(u=t.displayPl(),_=s.text,null===u||0===u?_.textColor:u>0?_.positiveTextColor:_.negativeTextColor),backgroundColor:s.text.backgroundColor,dividerColor:s.text.dividerColor},close:{title:xt,backgroundColor:s.close.backgroundColor,iconColor:s.close.iconColor,active:{visible:c,backgroundColor:s.close.activeColor}},reverse:{visible:!0,title:ft,backgroundColor:l.backgroundColor,iconColor:l.iconColor,active:{visible:d,backgroundColor:l.activeColor}},point:{visible:a,
backgroundColor:this._isSelectedItem(t)?o:Object(r.ensureDefined)(s.pointBackgroundColor),borderStyle:s.lineStyle,borderColor:o,shadowColor:h}};var u,_}_mainItemStyle(){const t=this._source.mainItem();return void 0===t?function(t,e,o){const r=o()?Y:K,i=t.isBuyDirection()?r.sell:r.buy;return{...e.isBlocked()?i.disabled:i.normal,lineStyle:t.isActive()?e.lineStyle():N.b.Dotted,borderStyle:t.isActive()?N.b.Solid:N.b.Dotted,labelBorderVisible:!0}}(this._source.tradedItems().brackets[0],this._source,()=>this._chartModel.isDark()):mt(t)?Z(t,this._source,()=>this._chartModel.isDark()):J(t,this._source,()=>this._chartModel.isDark())}}var St=o("KcY8");class Ot extends St.a{constructor(t,e,o,r,i){super(),this._model=t,this._data=e,this._source=o,this._showProperty=r,this._styleGetter=i}itemId(){return this._data.id()}_updateRendererData(t,e,o){if(t.visible=!1,!this._showProperty.value())return;const r=this._model.mainSeries(),i=r.priceScale(),s=r.firstValue();if(null===s)return;const l=this._data.price();if(null===l)return;const a=this._styleGetter();o.background=a.qty.backgroundColor,o.borderColor=a.labelBorderVisible?a.borderColor:void 0,o.borderStyle=a.labelBorderVisible?a.borderStyle:void 0,o.textColor=a.qty.textColor,o.coordinate=i.priceToCoordinate(l,s),t.borderVisible=a.labelBorderVisible,t.text=this._formatPrice(l),t.tickColor=a.labelTickColor,t.visible=!0}_formatPrice(t){return this._source.priceScaleFormatter().format(t)}}var Mt=o("TmNs");class Tt extends Mt.PriceLineAxisView{constructor(t,e,o,r,i,s,l){super(),this._chartModel=t,this._data=e,this._source=o,this._showProperty=s,this._height=r,this._verticalPadding=i,this._styleGetter=l}itemId(){return this._data.id()}_value(){const t=this._chartModel.mainSeries(),e=t.firstValue(),o=this._data.price();if(null===o||null===e)return{noData:!0};const r=t.priceScale().priceToCoordinate(o,e);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",text:"",index:0}}_updateRendererData(t,e,o){const r=this._styleGetter();t.linestyle=r.lineStyle,o.additionalPaddingTop=this._verticalPadding,o.additionalPaddingBottom=this._verticalPadding,super._updateRendererData(t,e,o)}_priceLineColor(t){return this._styleGetter().lineColor}_lineWidth(){return this._source.lineWidth()}_lineStyle(){return this._styleGetter().lineStyle}_backgroundAreaHeight(){return this._height}_isVisible(){return this._showProperty.value()}}function It(t,e,o){if(o instanceof j){const r=()=>Z(o,e,()=>t.isDark());return{priceAxisView:new Ot(t,o,e,e.showPositionProperty(),r),priceLineAxisView:new Tt(t,o,e,19,0,e.showPositionProperty(),r)}}const r=()=>J(o,e,()=>t.isDark());return{priceAxisView:new Ot(t,o,e,e.showOrderProperty(),r),priceLineAxisView:new Tt(t,o,e,17,1,e.showOrderProperty(),r)}}class Dt{constructor(t,e){this._model=t,this._source=e}updateAllViews(){void 0!==this._views.main&&(this._views.main.priceAxisView.update(),this._views.main.priceLineAxisView.update()),void 0!==this._views.stopLimit&&(this._views.stopLimit.priceAxisView.update(),
this._views.stopLimit.priceLineAxisView.update());for(const t of this._views.brackets)t.priceAxisView.update(),t.priceLineAxisView.update()}views(t,e){const o=this._source.hoveredItem()||null,r=this._source.selectedItem()||null,i=null!==o?o.id:null,s=null!==r?r.id:null,l=[],a=[];let n=null,c=null,d=null,h=null;const u=this._views.brackets.slice();this._views.main&&u.push(this._views.main),this._views.stopLimit&&u.push(this._views.stopLimit);for(const t of u)t.priceAxisView.itemId()===i?(n=t.priceAxisView,c=t.priceLineAxisView):t.priceAxisView.itemId()===s?(d=t.priceAxisView,h=t.priceLineAxisView):(l.push(t.priceAxisView),a.push(t.priceLineAxisView));return null!==d&&null!==h&&(l.push(d),a.push(h)),null!==n&&null!==c&&(l.push(n),a.push(c)),[l,a]}recreateViews(){const t=this._source.tradedItems();this._views={brackets:t.brackets.map(t=>It(this._model,this._source,t))},void 0!==t.main&&(this._views.main=It(this._model,this._source,t.main)),void 0!==t.stopLimit&&(this._views.stopLimit=It(this._model,this._source,t.stopLimit))}}class Lt extends d.a{constructor(t,e,o,r,i,s,l){super(t,e),this._symbol=null,this._isActualSymbol=!1,this._blockedData=null,this._isBlocked=!1,this._isDestroyed=!1,this._mainSeries=e.mainSeries(),this._properties=o,this._symbolDataProvider=i;const a=this._mainSeries.dataEvents();a.symbolResolved().subscribe(this,this._updateActualSymbolAndFormatter),a.symbolError().subscribe(this,this._updateActualSymbolAndFormatter),this._updateActualSymbolAndFormatter(),this._exitTrackingMode=s,this._currencyGetter=l,this._paneView=new kt(this._model,this),this._priceViewsGroup=new Dt(this._model,this),this._rawDataSpawn=r.spawn(),this._setData(this._rawDataSpawn.value(),!1),this._rawDataSpawn.subscribe(this._setData.bind(this)),this._properties.positionPL.visibility.subscribe(this,this.redraw),this._properties.positionPL.display.subscribe(this,this.redraw),this._model.hoveredSourceChanged().subscribe(this,()=>{if(!this._isActualSymbol)return;const t=this._model.hoveredSource();(null===t||t!==this&&t instanceof Lt)&&this.redraw()})}destroy(){var t;this._properties.showOrders.destroy(),this._properties.showPositions.destroy(),this._properties.positionPL.visibility.unsubscribeAll(this),this._properties.positionPL.display.unsubscribeAll(this);const e=this._mainSeries.dataEvents();e.symbolResolved().unsubscribeAll(this),e.symbolError().unsubscribeAll(this),this._rawDataSpawn.destroy(),null===(t=this._tradedItems.main)||void 0===t||t.destroy(),this._tradedItems.brackets.forEach(t=>t.destroy()),this._isDestroyed=!0}isSelectionEnabled(){return!0}priceScaleFormatter(){return this._mainSeries.formatter()}showPositionProperty(){return this._properties.showPositions}showOrderProperty(){return this._properties.showOrders}lineWidth(){return this._properties.lineProperties.width.value()}lineLength(){return this._properties.lineProperties.length.value()}lineStyle(){return this._properties.lineProperties.style.value()}isLineExtended(){return this._properties.lineProperties.extend.value()}isPositionPLVisible(){
return this._properties.positionPL.visibility.value()}positionDisplayMode(){return this._properties.positionPL.display.value()}horizontalAlignment(){return this._properties.horizontalAlignment.value()}isBlocked(){return this._isBlocked}setIsBlocked(t){this._isBlocked=t,this.redraw()}tradedItems(){return this._tradedItems}mainItem(){return this._tradedItems.main}hoveredItem(){const t=this._model.hoveredSource()===this&&this._model.lastHittestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}selectedItem(){const t=this._model.selection().isSelected(this)&&this._model.lastSelectedHittestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}priceScale(){return this._mainSeries.priceScale()}updateAllViews(){this._paneView.update(),this._priceViewsGroup.updateAllViews()}updateViewsForPane(t){this._isSourceShouldBeShown(t)&&this.updateAllViews()}paneViews(t){return this._isSourceShouldBeShown(t)?[this._paneView]:[]}priceAxisViews(t,e){if(!this._isSourceShouldBeShown(t))return[];const[o,r]=this._priceViewsGroup.views(t,e);return t.findTargetPriceAxisViews(this,e,o,r)}redraw(){this.updateAllViews(),this._model.updateSource(this)}syncData(){this._isDestroyed||(null!==this._blockedData?(this._setData(this._blockedData),this._blockedData=null):this._setData(this._rawDataSpawn.value()))}_createMainItem(t){var e,o;let r;return 0===(null===(e=t.main)||void 0===e?void 0:e.mainType)?r=new S(0,t.main,this,this._mainSeries,this._symbolDataProvider,this._exitTrackingMode):1===(null===(o=t.main)||void 0===o?void 0:o.mainType)&&(r=new j(0,t.main,this,this._symbolDataProvider,this._currencyGetter)),r}_createStopLimitItem(t,e){let o;if(void 0!==t.main&&e instanceof S&&4===e.type()){const e=Object(i.merge)(Object(i.clone)(t.main),{price:t.main.limitPrice,considerFilledQty:!1,isActive:!0});o=new S(1,e,this,this._mainSeries,this._symbolDataProvider,this._exitTrackingMode,!0)}return o}_createItems(t){const e=this._createMainItem(t),o=this._createStopLimitItem(t,e);this._tradedItems={main:e,stopLimit:o,brackets:t.brackets.map((t,e)=>new S(2+e,t,this,this._mainSeries,this._symbolDataProvider,this._exitTrackingMode))}}_updateItems(t){if(void 0!==this._tradedItems.main)if(void 0!==t.main)if(this._tradedItems.main instanceof S){if(0!==t.main.mainType)throw new Error("Main item was order");this._tradedItems.main.setData(t.main),void 0!==this._tradedItems.stopLimit&&(4!==t.main.type?(this._tradedItems.main.setData(Object(i.merge)(this._tradedItems.stopLimit.data(),{type:t.main.type,price:t.main.price})),delete this._tradedItems.stopLimit):this._tradedItems.stopLimit.setData(Object(i.merge)(Object(i.clone)(t.main),{price:t.main.limitPrice})))}else{if(1!==t.main.mainType)throw new Error("Main item was order");this._tradedItems.main.setData(t.main)}else delete this._tradedItems.main;else void 0!==t.main&&(this._tradedItems.main=this._createMainItem(t),this._tradedItems.stopLimit=this._createStopLimitItem(t,this._tradedItems.main));this._tradedItems.brackets.length=t.brackets.length,t.brackets.forEach((t,e)=>{
void 0===this._tradedItems.brackets[e]?this._tradedItems.brackets[e]=new S(2+e,t,this,this._mainSeries,this._symbolDataProvider,this._exitTrackingMode):this._tradedItems.brackets[e].setData(t)})}_setData(t,e=!0){var o,r;this.isBlocked()?(this._blockedData=t,this._tradedItems.main instanceof j&&this._tradedItems.main.setData(t.main)):(e?this._updateItems(t):this._createItems(t),this._priceViewsGroup.recreateViews());const i=(null===(o=t.main)||void 0===o?void 0:o.symbol)||(null===(r=t.brackets[0])||void 0===r?void 0:r.symbol)||null;i!==this._symbol&&(this._symbol=i,this._updateActualSymbolAndFormatter()),this.redraw()}_updateActualSymbolAndFormatter(){if(null===this._symbol)return;if(null===this._mainSeries.symbolInfo())this._isActualSymbol=!1;else{const t=this._mainSeries.isConvertedToOtherCurrency()||this._mainSeries.isConvertedToOtherUnit();this._isActualSymbol=!t&&this._mainSeries.symbolSameAsCurrent(this._symbol)}this._updateItemBySymbol(),this.redraw()}_updateItemBySymbol(){null!==this._symbol&&this._isActualSymbol?this._tradedItems.main instanceof j&&(this._tradedItems.main.subscribeRealtime(),this._tradedItems.main.updateCurrency(this._symbol)):this._tradedItems.main instanceof j&&this._tradedItems.main.clearRealtime()}_isSourceShouldBeShown(t){return!!this._isActualSymbol&&(!!t.containsMainSeries()&&!(window.TradingView.printing&&!h.enabled("snapshot_trading_drawings")))}}o.d(e,"TradedSourcesManager",(function(){return Rt}));const jt=Object(l.getLogger)("Trading.Order");class Rt{constructor(t,e,o,r){this._ordersData=new Map,this._positionsData=new Map,this._positionsRealToParentIds=new Map,this._tradedSourceData=new Map,this._ordersService=t,this._positionsService=e,this._chartWidgetCollection=o,this._realtimeProvider=r.realtimeProvider,this._brokerCommandsUIGetter=r.brokerCommandsUI,this._trackEvent=r.trackEvent,this._addOrderItems(this._ordersService.activeOrders()),this._ordersService.activeOrdersUpdated().subscribe(this,t=>this._addOrderItems([t])),this._ordersService.activeOrdersRemoved().subscribe(this,this._removeTradedSources),this._addPositionItems(this._positionsService.positions()),this._positionsService.positionUpdate().subscribe(this,t=>this._addPositionItems([t])),this._positionsService.positionsRemoved().subscribe(this,this._removeTradedSources)}destroy(){this._ordersService.activeOrdersUpdated().unsubscribeAll(this),this._ordersService.activeOrdersRemoved().unsubscribeAll(this),this._ordersData.clear(),this._tradedSourceData.clear()}_getBrackets(t){const e=[];if(!this._ordersData.has(t)){const e=this._positionsRealToParentIds.get(t);void 0!==e&&(t=e)}return this._ordersData.forEach(o=>{o.parentId===t&&e.push(Object(i.merge)(Object(i.clone)(o),{callbacks:this._createCallbacksForOrder(o)}))}),e}_createTradedSourceData(t){let e;const o=this._ordersData.get(t),r=this._positionsData.get(t);return void 0!==o?e=Object(i.merge)(Object(i.clone)(o),{mainType:0,callbacks:this._createCallbacksForOrder(o)}):void 0!==r&&(e=Object(i.merge)(Object(i.clone)(r),{mainType:1,
callbacks:this._createCallbacksForPosition()})),{main:e,brackets:this._getBrackets(t)}}_recreateTradedSource(t){const e=this._createTradedSourceData(t),o=this._tradedSourceData.get(t);if(void 0!==o)o.setValue(e);else{const o=new s.a(e);r=this._chartWidgetCollection,i=this._realtimeProvider,l=t,a=o,d=this._positionsService.getCurrency.bind(this._positionsService),r.addCustomSource("traded"+l,(t,e)=>{const o=e.properties().childs().tradingProperties.childs(),s=Object(c.b)(e.isInReplay.bind(e),e.onInReplayStateChanged()),l=Object(c.a)((t,e)=>e,s,o.showOrders),n=Object(c.a)((t,e)=>e,s,o.showPositions),h={lineProperties:{width:o.lineWidth,length:o.lineLength,style:o.lineStyle,extend:o.extendLeft},horizontalAlignment:o.horizontalAlignment,showOrders:l,showPositions:n,positionPL:o.positionPL.childs()};return new Lt(t,e,h,a,i,()=>r.activeChartWidget.value().exitTrackingMode(),d)},n.CustomSourceLayer.Topmost),this._tradedSourceData.set(t,o)}var r,i,l,a,d}async _findPositionRealIdByParentId(t){const e=this._positionsData.get(t);let o;if(void 0!==e)o=e.id;else if(o=await this._positionsService.realIdFromBroker(t),null===o){const e=this._currentRealPositionIdByParentId(t);return null!==e&&this._positionsRealToParentIds.delete(e),null}return this._positionsRealToParentIds.set(o,t),o}_currentRealPositionIdByParentId(t){for(const e of Array.from(this._positionsRealToParentIds.keys()))if(this._positionsRealToParentIds.get(e)===t)return e;return null}async _findAndUpdateParentPosition(t,e=!1){const o=this._currentRealPositionIdByParentId(t),r=await this._findPositionRealIdByParentId(t);if(null!==o&&null===r&&this._tradedSourceData.has(o)&&this._recreateTradedSource(o),null===o&&null!==r){const e=this._tradedSourceData.get(t);void 0!==e&&void 0===e.value().main&&this._removeTradedSources([t])}e&&o===r||this._recreateTradedSource(r||t)}_addOrderItems(t){for(const e of t){this._removeSourceIfChangedParent(e),this._ordersData.set(e.id,e);const t=void 0!==e.parentId?e.parentId:e.id;if(2===e.parentType||3===e.parentType)return void this._findAndUpdateParentPosition(t);this._recreateTradedSource(t)}}_addPositionItems(t){for(const e of t){const t=e.id;this._positionsData.set(t,e),this._recreateTradedSource(t);this._ordersService.activeOrders().filter(t=>1!==t.parentType&&void 0!==t.parentType&&t.symbol===e.symbol).forEach(t=>{this._findAndUpdateParentPosition(t.parentId,!0)})}}_removeSourceIfChangedParent(t){const e=this._ordersData.get(t.id);void 0===e||e.parentId===t.parentId&&e.parentType===t.parentType||this._removeTradedSources([e.id])}_removeTradedSources(t){for(const r of t)if(this._tradedSourceData.has(r))e=this._chartWidgetCollection,o=r,e.removeCustomSource("traded"+o),this._positionsData.delete(r),this._ordersData.delete(r),this._tradedSourceData.delete(r);else{const t=this._ordersData.get(r);if(void 0!==t)if(this._ordersData.delete(r),1===t.parentType)this._recreateTradedSource(t.parentId);else{const e=this._currentRealPositionIdByParentId(t.parentId);this._recreateTradedSource(e||t.parentId)}}var e,o}_createCallbacksForOrder(t){
const e={cancelOrder:this._cancelOrder.bind(this)};return t.supportModify&&(e.modifyOrder=this._modifyOrder.bind(this),e.moveOrder=this._moveOrder.bind(this)),e}_createCallbacksForPosition(){return{reversePosition:this._reversePosition.bind(this),modifyPosition:this._modifyPosition.bind(this),closePosition:this._closePosition.bind(this)}}async _processingModifyOrder(t,e,o){let i;4===o.type&&(t.useLimitPrice||(i=2),t.useStopPrice||(i=1));let s=!1;try{s=await Object(r.ensureNotNull)(this._brokerCommandsUIGetter()).modifyOrder(e,t.silent,i)}catch(t){jt.logError("Try to modify order with error "+Object(a.a)(t))}return s}_modifyOrder(t,e,o,i=!1){this._trackEvent(t,"Edit Order");const s={useLimitPrice:i},l=Object(r.ensureNotNull)(this._ordersService.find(e));return this._processingModifyOrder(s,o,l)}_moveOrder(t,e,o,i=!1){this._trackEvent(t,"Move Order");const s={silent:!0};i?s.useLimitPrice=!0:s.useStopPrice=Boolean(o.stopPrice);const l=Object(r.ensureNotNull)(this._ordersService.find(e));return this._processingModifyOrder(s,o,l)}_cancelOrder(t,e){return this._trackEvent(t,"Cancel Order"),Object(r.ensureNotNull)(this._brokerCommandsUIGetter()).cancelOrder(e)}_reversePosition(t,e){return this._trackEvent(t,"Reverse Position"),Object(r.ensureNotNull)(this._brokerCommandsUIGetter()).reversePosition(e)}_modifyPosition(t,e){this._trackEvent(t,"Edit Position");const o=Object(r.ensureNotNull)(this._brokerCommandsUIGetter());return this._positionsService.isDisplayModeTrades()?Object(r.ensureDefined)(o.editTradeBrackets).call(o,e):o.editPositionBrackets(e,{})}_closePosition(t,e){this._trackEvent(t,"Close Position");const o=Object(r.ensureNotNull)(this._brokerCommandsUIGetter());return this._positionsService.isDisplayModeTrades()?o.closeTrade(e):o.closePosition(e)}}},bydf:function(t,e,o){"use strict";o.r(e);var r=o("Eyy1"),i=o("ogJP"),s=o("KtbP"),l=o("oV8k"),a=o("TmNs");class n extends a.PriceLineAxisView{constructor(t,e,o){super(),this._model=t,this._source=e,this._priceType=o}_value(){const t=this._model.mainSeries(),e=t.priceScale(),o=t.firstValue();if(null===o)return{noData:!0};const r=this._source.getPrice(this._priceType);if(null===r)return{noData:!0};const i=e.priceToCoordinate(r,o);return{noData:!1,floatCoordinate:i,coordinate:i,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",text:"",index:0}}_priceLineColor(t){const e=this._source.properties().childs();return 0===this._priceType?e.bidLineColor.value():e.askLineColor.value()}_lineWidth(){return this._source.properties().childs().lineWidth.value()}_lineStyle(){return this._source.properties().childs().lineStyle.value()}_isVisible(){return this._source.properties().childs().visible.value()}}var c=o("YFKU"),d=o("KcY8");class h extends d.a{constructor(t,e,o){super(),this._model=t,this._source=e,this._priceType=o}_updateRendererData(t,e,o){if(t.visible=!1,e.visible=!1,!this._model.properties().scalesProperties.showBidAskLabels.value())return;const r=this._model.mainSeries(),i=r.priceScale(),s=r.firstValue();if(null===s)return
;const l=this._source.getPrice(this._priceType);if(null===l)return;t.visible=!0,e.visible=!0,t.text=i.formatPriceAbsolute(l),e.text=0===this._priceType?Object(c.t)("Bid"):Object(c.t)("Ask"),o.coordinate=i.priceToCoordinate(l,s);const a=this._source.properties().childs();o.background=0===this._priceType?a.bidLineColor.value():a.askLineColor.value()}}var u=o("2ijp"),_=o("VdBB");class b extends u.a{constructor(t,e,o,r){super(),this._model=t,this._source=e,this._priceType=o;const i={doubleClickHandler:r,doubleTapHandler:r};this._lineRenderer.setHitTest(new _.HitTestResult(_.HitTestResult.REGULAR,i))}_updateImpl(){const t=this._lineRendererData;t.visible=!1;const e=this._source.properties().childs();if(!e.visible.value())return;const o=this._model.mainSeries(),r=o.priceScale(),i=o.firstValue();if(null===i)return;const s=this._source.getPrice(this._priceType);null!==s&&(t.visible=!0,t.y=r.priceToCoordinate(s,i),t.linestyle=e.lineStyle.value(),t.linewidth=e.lineWidth.value(),t.color=0===this._priceType?e.bidLineColor.value():e.askLineColor.value())}}o.d(e,"BidAsk",(function(){return p}));class p extends l.a{constructor(t,e,o,r){super(t,e),this._ask=null,this._bid=null,this._symbol=null,this._realtimeProvider=o,this._bidLinesPaneView=new b(e,this,0,r),this._askLinesPaneView=new b(e,this,1,r),this._bidPriceAxisView=new h(e,this,0),this._askPriceAxisView=new h(e,this,1),this._regularPriceAxisViews=[this._bidPriceAxisView,this._askPriceAxisView],this._bidLabelPaneView=new s.PanePriceAxisView(this._bidPriceAxisView,e.mainSeries(),e),this._askLabelPaneView=new s.PanePriceAxisView(this._askPriceAxisView,e.mainSeries(),e),this._bidPriceLineAxisView=new n(e,this,0),this._askPriceLineAxisView=new n(e,this,1),this._externalPriceAxisViews=[this._bidPriceLineAxisView,this._askPriceLineAxisView],this._updateRealtimeDataHandler=this._updateRealtimeData.bind(this);const i=e.mainSeries().dataEvents();i.symbolResolved().subscribe(this,this._createTradedSymbol),i.symbolError().subscribe(this,this._createTradedSymbol),this._createTradedSymbol()}destroy(){const t=this._model.mainSeries().dataEvents();t.symbolResolved().unsubscribeAll(this),t.symbolError().unsubscribeAll(this),this._clearTradedSymbol()}paneViews(t){return this._isMainSourcePane(t)?[this._bidLinesPaneView,this._askLinesPaneView]:[]}labelPaneViews(t){return this._isMainSourcePane(t)?[this._bidLabelPaneView,this._askLabelPaneView]:[]}priceAxisViews(t,e){return this._isMainSourcePane(t)?t.findTargetPriceAxisViews(this,e,this._regularPriceAxisViews,this._externalPriceAxisViews):[]}priceScale(){return this._model.mainSeries().priceScale()}updateAllViews(){this._bidLinesPaneView.update(),this._askLinesPaneView.update(),this._bidPriceAxisView.update(),this._askPriceAxisView.update(),this._bidPriceLineAxisView.update(),this._askPriceLineAxisView.update(),this._bidLabelPaneView.update(),this._askLabelPaneView.update()}getPrice(t){return 1===t?this._ask:this._bid}properties(){return this._model.mainSeries().properties().bidAsk}_createTradedSymbol(){const t=function(t){
if(t.isConvertedToOtherCurrency()||t.isConvertedToOtherUnit())return null;const e=t.symbolInfo();return null===e?t.proSymbol():e.pro_name||e.full_name||e.name||null}(this._model.mainSeries());t!==this._symbol&&(this._clearTradedSymbol(),null!==t&&this._initTradedSymbol(t))}_initTradedSymbol(t){this._symbol=t,this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler)}_clearTradedSymbol(){this._ask=null,this._bid=null,null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(Object(r.ensureNotNull)(this._symbol),this._updateRealtimeDataHandler),this._symbol=null)}_updateRealtimeData(t,e,o){const r=e.ask,s=e.bid;r===s?(this._ask=null,this._bid=null):(Object(i.isNumber)(r)&&(this._ask=r),Object(i.isNumber)(s)&&(this._bid=s)),(this._model.mainSeries().properties().bidAsk.visible.value()||this._model.properties().scalesProperties.showBidAskLabels.value())&&(this.updateAllViews(),this._model.updateSource(this))}_isMainSourcePane(t){return this._model.paneForSource(this._model.mainSeries())===t}}},"fA+p":function(t,e,o){"use strict";o.r(e),o.d(e,"ExecutionsService",(function(){return d}));var r=o("Eyy1"),i=o("ogJP"),s=o("kcTO"),l=o("2TBc"),a=o("aIyQ"),n=o.n(a),c=o("4qhP");class d extends l.a{constructor(t,e,o){super(t),this._allExecutionsID=new Set,this._executions=[],this._executionsAdded=new n.a,this._executionsCleared=new n.a,this._formatter=new s.PriceFormatter,this._symbol="",this._dataEvents=e,this._getSymbolName=o,this._initialized=!0,this._tryToStart()}destroy(){this.stopService()}formatter(){return this._formatter}executions(){return this._executions}executionsAdded(){return this._executionsAdded}executionsCleared(){return this._executionsCleared}startService(){var t;(null===(t=this.activeBroker())||void 0===t?void 0:t.config.supportExecutions)&&(this._canBeStarted=!0,this._tryToStart())}stopService(){this._canBeStarted=!1,this._isStarted&&this._stop()}_tryToStart(){Object(r.assert)(!this._isStarted,"Execution's service has already started"),this._canBeStarted&&this._initialized&&this._start()}_start(){Object(r.assert)(!this._isStarted,"Execution's service has already started"),this._isStarted=!0,this._dataEvents.symbolResolved().subscribe(this,this._createExecutions),this._dataEvents.symbolError().subscribe(this,this._createExecutions),this._createExecutions()}_stop(){this._isStarted=!1,this._clearExecutions();Object(r.ensure)(this.activeBroker()).executionUpdate.unsubscribeAll(this),this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this)}_createExecutions(){this._clearExecutions(),this._symbol=this._getSymbolName(),this._symbol&&this._requestFormatterAndExecutions()}_clearExecutions(){this._allExecutionsID=new Set,this._executions=[],this._executionsCleared.fire()}async _requestFormatterAndExecutions(){const t=this.activeBroker();if(!t)return;if(!this._symbol)return;if(!(await t.isTradable(this._symbol)).tradable)return;const e=this._symbol;Promise.all([t.formatter(this._symbol,!1),t.executions(this._symbol)]).then(([o,r])=>{
this._symbol===e&&(this._formatter=o,this._executions=r.map(t=>this._createExecutionData(t)).filter(i.notNull),this._executionsAdded.fire(this._executions),t.executionUpdate.unsubscribeAll(this),t.executionUpdate.subscribe(this,this._addExecution))})}_addExecution(t){const e=this._createExecutionData(t);null!==e&&this._executionsAdded.fire([e])}_createExecutionData(t){return t.symbol!==this._symbol||this._allExecutionsID.has(t.id)?null:(this._allExecutionsID.add(t.id),{...t,tooltip:Object(c.d)(t,this._formatter)})}}}}]);