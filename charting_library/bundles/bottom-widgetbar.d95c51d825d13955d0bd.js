(window.webpackJsonp=window.webpackJsonp||[]).push([["bottom-widgetbar"],{"3A7E":function(e,t,i){},Vg5g:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"Bottomwidgetbar",(function(){return r}));i("P5fv");var s=i("hY0g"),a=i.n(s),o=i("Vdly"),n=i("dwZ6"),h=i("ZzsE");i("3A7E"),i("i8AX");class r{constructor(e,t){this._inited=!1,this._minHeight=30,this._paddingTop=n.a,this.open=()=>{"minimized"===this._mode.value()&&this._mode.setValue("normal")},this.close=()=>{this._mode.setValue("minimized")},this.toggleMaximize=()=>{switch(this._mode.value()){case"minimized":case"normal":this._mode.setValue("maximized");break;case"maximized":this._mode.setValue("normal")}},this.toggleMinimize=()=>{switch(this._mode.value()){case"minimized":this.open();break;case"normal":case"maximized":this.close()}},this._mode=new a.a,this._isOverlap=new a.a,this._isVisible=new a.a,this._activeWidget=new a.a,this._widgets={},this._buttons={},this._widgetsProperties={},this._normalHeight=new a.a,this._actualHeight=new a.a,this._userSettings=t,this._options=e||{},this._config=e.config,this._enabledWidgets=(e&&e.widgets||[]).filter(e=>e&&Boolean(this._config[e])),this._init(e)}activeWidget(){return this._activeWidget.readonly()}footerWidgetContainer(){return this._$footerWidgetContainer[0]}toggleWidget(e,t){return new Promise(i=>{"boolean"==typeof e?e?this.open():this.close():this.isWidgetEnabled(e)&&(t?this.open():this.activeWidget().value()===e&&"minimized"!==this.mode().value()?this.close():this.open(),this._activeWidget.setValue(e)),i()})}getWidgetByName(e){return this._widgets[e]||null}getButtonByName(e){return this._buttons[e]||null}mode(){return this._mode.readonly()}isOverlap(){return this._isOverlap.readonly()}setNormalHeight(e){this._normalHeight.setValue(e)}destroy(){}isWidgetEnabled(e){return this._enabledWidgets.includes(e)}activateTradingTab(){return this.toggleWidget("paper_trading",!0).then(()=>{const e=this.getWidgetByName("paper_trading");e&&e.activate&&e.activate()})}activateScriptEditorTab(e){this.toggleWidget("screener",!0).then(()=>{const t=this._config.scripteditor;t&&t.ctor.open(e)})}turnOffMaximize(){"maximized"===this._mode.value()&&this.toggleMaximize()}enabledWidgets(){return this._enabledWidgets.map(e=>this._config[e])}activeWidgetName(){return this._activeWidget.value()}isVisible(){return this._isVisible.readonly()}_init(t){if(!this._enabledWidgets.length||this._inited)return;this._createLayout(e(this._options.resizerBridge.container.value()));const i=()=>{let e=0;switch(this._mode.value()){case"normal":e=this._normalHeight.value();break;case"maximized":e=this._resizerAvailHeight()}const t={min:Math.min(this._getPaddingBoxHeight(e),this._getPaddingBoxHeight(this._minHeight)),max:this._getPaddingBoxHeight(e)};this._options.resizerBridge.negotiateHeight(t)},s=()=>{if("minimized"!==this._mode.value()){const i=this._activeWidget.value();let s;if(this._$container.removeClass("js-hidden").css({height:this._actualHeight.value()}),this._$container.find(".bottom-widgetbar-content").addClass("js-hidden"),this._widgets[i]){
const e=this._widgets[i];e&&e._$content&&(s=e._$content,s.removeClass("js-hidden"))}else{s=e(document.createElement("div")).attr("class","bottom-widgetbar-content "+i),s.appendTo(this._$container),this._initWidgetProperties(i);const o=new a.a;this._activeWidget.subscribe(e=>{o.setValue(e===i)},{callWithLast:!0});const n=()=>{this.toggleWidget(i,!0)},h=this._config[i];if(h){const e=h.ctor;this._widgets[i]=new e({$body:s,container:s[0],bottomAreaContainer:this._$container[0],height:this._actualHeight,width:this._options.resizerBridge.width,bottomToolbarMode:this.mode(),visible:o.readonly(),properties:this._widgetsProperties[i],activate:n,chartWidgetCollection:t.chartWidgetCollection||null,originalStandalone:"screener"===i,backtestingStrategyDispatcher:this._options.backtestingStrategyDispatcher})}const r=this._widgets[i];r&&(r._$content=s,r.disabled&&r.disabled.subscribe(e=>{this._$loadingOverlay.toggleClass("js-hidden",!e)}))}}this._normalHeight.unsubscribe(i),this._normalHeight.subscribe(i),this._mode.unsubscribe(i),this._mode.subscribe(i),this._options.resizerBridge.availHeight.unsubscribe(i),this._options.resizerBridge.availHeight.subscribe(i),i(),this._save()};this._mode.subscribe(s),this._activeWidget.subscribe(s),this._normalHeight.subscribe(()=>{this._save()}),this._mode.subscribe(()=>{this._save()}),this._options.resizerBridge.height.subscribe(()=>{const e=this._options.resizerBridge.height.value(),t=Math.max(this._getContentBoxHeight(e),0);this._$container.css("height",t),this._actualHeight.setValue(t)},{callWithLast:!0}),this._registerWidgets(),this._loadState(),this._subscribeCheckOverlap(),this._subscribeVisibility(),this._inited=!0}_getContentBoxHeight(e){return e-this._paddingTop}_getPaddingBoxHeight(e){return e+this._paddingTop}_subscribeCheckOverlap(){this._checkOverlap(),this._actualHeight.subscribe(()=>{this._checkOverlap()}),this._mode.subscribe(()=>{this._checkOverlap()}),this._options.resizerBridge.availHeight.subscribe(()=>{this._checkOverlap()})}_updateVisibility(){this._isVisible.setValue(this._options.resizerBridge.visible.value())}_subscribeVisibility(){this._updateVisibility(),this._options.resizerBridge.visible.subscribe(()=>{this._updateVisibility()})}_createLayout(t){t[0].innerHTML="",this._$footerWidgetContainer=e("<div>").css({height:n.a}).appendTo(t),this._$container=e("<div>").attr("id","bottom-area").appendTo(t),e(document.createElement("div")).attr("class","bottom-widgetbar-handle").appendTo(this._$container).on("contextmenu",e=>{e.preventDefault()}).on("mousedown touchstart",this._onLayoutResizeHandleMousedown.bind(this)),this._$loadingOverlay=e(document.createElement("div")).attr("class","bottom-widgetbar-loading-overlay js-hidden").appendTo(this._$container)}_onLayoutResizeHandleMousedown(t){if(t.defaultPrevented)return;t.preventDefault();const i=this._mode.value(),s=this._normalHeight.value(),a="minimized"===this._mode.value()?0:this._$container.height();let o;o=t.originalEvent.touches?t.originalEvent.touches[0].clientY:t.pageY;const n=e=>{let t
;t=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY;const i=t-o;let s="minimized"===this._mode.value(),n=a-i;n<=0?(n=a,s=!0):s=!1,n=Math.max(n,this._minHeight),isFinite(n)&&("minimized"===this._mode.value()!==s?s?(this._mode.setValue("minimized"),this.setNormalHeight(Math.max(a,this._minHeight))):(this._mode.setValue("normal"),this.setNormalHeight(n)):this._normalHeight.value()!==n&&(n>=this._getContentBoxHeight(this._resizerAvailHeight())?(this._mode.setValue("maximized"),this.setNormalHeight(a)):(this._mode.setValue("normal"),this.setNormalHeight(n))))},h=()=>{s>0&&"normal"!==this._mode.value()&&"normal"!==i&&this.setNormalHeight(s),e(document.documentElement).off("mousemove touchmove",n).off("mouseup touchend",h),this._save()};e(document.documentElement).on("mousemove touchmove",n).on("mouseup touchend",h)}_checkOverlap(){const e=this._getPaddingBoxHeight(this._actualHeight.value()),t=this._mode.value();this._isOverlap.setValue("maximized"===t||"normal"===t&&this._resizerAvailHeight()-e<=300)}_resizerAvailHeight(){return this._options.resizerBridge.availHeight.value()}_initWidgetProperties(e){const t="bottom"+e+"widget",i=new a.a(o.getJSON(t,null));i.subscribe(e=>{e?o.setJSON(t,e):o.remove(t)}),this._widgetsProperties[e]=i}_loadState(){const e=this._userSettings;this._mode.setValue(e.mode),this._activeWidget.setValue(this.isWidgetEnabled(e.activeWidget)?e.activeWidget:this._enabledWidgets[0]),this.setNormalHeight(Math.max(e.height,this._minHeight))}_save(){this._inited&&Object(h.c)({activeWidget:this._activeWidget.value(),height:this._normalHeight.value(),mode:this._mode.value()})}_registerWidgets(){this._enabledWidgets.forEach(e=>{const t=this._config[e];if(!t||"function"!=typeof t.onRegister)return;t.onRegister.call(null,{activate:()=>{this.toggleWidget(e,!0)},name:e})})}}}.call(this,i("P5fv"))},i8AX:function(e,t,i){}}]);